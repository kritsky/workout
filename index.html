<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–ª–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="max-w-lg mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-4 text-gray-800">üèãÔ∏è –°–∏–ª–æ–≤—ã–µ</h1>
        
        <!-- –î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex items-center gap-3">
                <label class="text-gray-600">–î–∞—Ç–∞:</label>
                <input type="date" id="workoutDate" class="border rounded px-3 py-1 flex-1">
                <button onclick="loadWorkout()" class="bg-gray-200 px-3 py-1 rounded text-sm">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>

        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex gap-2 mb-3">
                <select id="exercise" class="flex-1 border rounded px-3 py-2">
                    <option value="">–í—ã–±—Ä–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                    <optgroup label="–ì—Ä—É–¥—å">
                        <option>–ñ–∏–º –ª—ë–∂–∞</option>
                        <option>–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –ø–æ–¥ —É–≥–ª–æ–º 45¬∞</option>
                        <option>–û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞</option>
                        <option>–°–≤–µ–¥–µ–Ω–∏–µ –≤ —Ç—Ä–µ–Ω–∞–∂—ë—Ä–µ</option>
                    </optgroup>
                    <optgroup label="–°–ø–∏–Ω–∞">
                        <option>–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏</option>
                        <option>–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ –±–ª–æ–∫–∞ –∫ –ø–æ—è—Å—É</option>
                        <option>–¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ</option>
                        <option>–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è (–≥—Ä–∞–≤–∏—Ç—Ä–æ–Ω)</option>
                    </optgroup>
                    <optgroup label="–ù–æ–≥–∏">
                        <option>–ü—Ä–∏—Å–µ–¥–∞–Ω–∏–µ –≤ –≥–∞–∫–∫-—Ç—Ä–µ–Ω–∞–∂—ë—Ä–µ</option>
                        <option>–ü—Ä–∏—Å–µ–¥ —Å –≥–∏—Ä–µ–π</option>
                        <option>–í—ã–ø–∞–¥—ã –Ω–∞ –º–µ—Å—Ç–µ</option>
                        <option>–ù–æ–≥–∏ –±—ë–¥—Ä–∞</option>
                        <option>–ù–æ–≥–∏ –∏–∫—Ä—ã</option>
                    </optgroup>
                    <optgroup label="–ü–ª–µ—á–∏">
                        <option>–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –ø–ª–µ—á–∏</option>
                        <option>–ñ–∏–º –ê—Ä–Ω–æ–ª—å–¥–∞</option>
                        <option>–ú–∞—Ö–∏ –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω—É</option>
                    </optgroup>
                    <optgroup label="–†—É–∫–∏">
                        <option>–ú–æ–ª–æ—Ç–∫–∏ (–±–∏—Ü–µ–ø—Å)</option>
                        <option>–ü–æ–¥—ä—ë–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –±–∏—Ü–µ–ø—Å</option>
                        <option>–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –≤ –±–ª–æ–∫–µ (—Ç—Ä–∏—Ü–µ–ø—Å)</option>
                    </optgroup>
                    <optgroup label="–ö–æ—Ä">
                        <option>–ü—Ä–µ—Å—Å</option>
                    </optgroup>
                </select>
                <input type="text" id="customExercise" placeholder="–ò–ª–∏ —Å–≤–æ—ë" class="w-28 border rounded px-2 py-2 text-sm">
            </div>
            
            <!-- –ü–æ–¥—Ö–æ–¥—ã -->
            <div id="setsContainer" class="space-y-2 mb-3">
                <div class="flex gap-2 items-center set-row">
                    <span class="text-gray-400 text-sm w-6">1.</span>
                    <input type="number" placeholder="–í–µ—Å" class="set-weight w-20 border rounded px-2 py-1 text-center">
                    <span class="text-gray-400">–∫–≥ √ó</span>
                    <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                </div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="addSetRow()" class="flex-1 bg-gray-100 text-gray-600 py-2 rounded text-sm hover:bg-gray-200">
                    + –ü–æ–¥—Ö–æ–¥
                </button>
                <button onclick="saveExercise()" id="saveBtn" class="flex-1 bg-blue-500 text-white py-2 rounded font-medium hover:bg-blue-600">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
                <button onclick="cancelEdit()" id="cancelBtn" class="hidden bg-gray-300 text-gray-700 py-2 px-3 rounded font-medium hover:bg-gray-400">
                    ‚úï
                </button>
            </div>
        </div>

        <!-- –¢–µ–∫—É—â–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ -->
        <div class="bg-white rounded-lg shadow mb-4">
            <div class="p-3 border-b flex justify-between items-center">
                <span class="font-medium text-gray-700">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
                <span id="totalVolume" class="text-sm text-gray-500"></span>
            </div>
            <div id="currentWorkout" class="divide-y">
                <p class="p-4 text-gray-400 text-center text-sm">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ –æ–±—ä—ë–º–∞ -->
        <div class="bg-white rounded-lg shadow mb-4">
            <div class="p-3 border-b">
                <span class="font-medium text-gray-700">–û–±—ä—ë–º –ø–æ –¥–Ω—è–º</span>
            </div>
            <div id="volumeChart" class="p-3 flex items-end gap-1 h-32 overflow-x-auto"></div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-3 border-b">
                <span class="font-medium text-gray-700">–ò—Å—Ç–æ—Ä–∏—è</span>
            </div>
            <div id="history" class="divide-y max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        let workouts = JSON.parse(localStorage.getItem('strengthWorkouts') || '{}');
        let currentExercises = [];
        let editingIndex = null; // –ò–Ω–¥–µ–∫—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

        document.getElementById('workoutDate').valueAsDate = new Date();

        function getDateKey() {
            return document.getElementById('workoutDate').value;
        }

        function addSetRow() {
            const container = document.getElementById('setsContainer');
            const num = container.children.length + 1;
            const lastRow = container.lastElementChild;
            const lastWeight = lastRow?.querySelector('.set-weight')?.value || '';
            
            const row = document.createElement('div');
            row.className = 'flex gap-2 items-center set-row';
            row.innerHTML = `
                <span class="text-gray-400 text-sm w-6">${num}.</span>
                <input type="number" placeholder="–í–µ—Å" value="${lastWeight}" class="set-weight w-20 border rounded px-2 py-1 text-center">
                <span class="text-gray-400">–∫–≥ √ó</span>
                <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                <button onclick="this.parentElement.remove(); renumberSets()" class="text-gray-300 hover:text-red-500">‚úï</button>
            `;
            container.appendChild(row);
        }

        function renumberSets() {
            const rows = document.querySelectorAll('.set-row');
            rows.forEach((row, i) => {
                row.querySelector('span').textContent = (i + 1) + '.';
            });
        }

        function editExercise(index) {
            const ex = currentExercises[index];
            editingIndex = index;

            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            const exerciseSelect = document.getElementById('exercise');
            const customInput = document.getElementById('customExercise');

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ
            const options = Array.from(exerciseSelect.options).map(o => o.value);
            if (options.includes(ex.exercise)) {
                exerciseSelect.value = ex.exercise;
                customInput.value = '';
            } else {
                exerciseSelect.value = '';
                customInput.value = ex.exercise;
            }

            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥—Ö–æ–¥—ã
            const container = document.getElementById('setsContainer');
            container.innerHTML = ex.sets.map((s, i) => `
                <div class="flex gap-2 items-center set-row">
                    <span class="text-gray-400 text-sm w-6">${i + 1}.</span>
                    <input type="number" placeholder="–í–µ—Å" value="${s.weight}" class="set-weight w-20 border rounded px-2 py-1 text-center">
                    <span class="text-gray-400">–∫–≥ √ó</span>
                    <input type="number" placeholder="–†–∞–∑" value="${s.reps}" class="set-reps w-16 border rounded px-2 py-1 text-center">
                    ${i > 0 ? '<button onclick="this.parentElement.remove(); renumberSets()" class="text-gray-300 hover:text-red-500">‚úï</button>' : ''}
                </div>
            `).join('');

            // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('saveBtn').textContent = '–û–±–Ω–æ–≤–∏—Ç—å';
            document.getElementById('cancelBtn').classList.remove('hidden');

            // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
            document.getElementById('exercise').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function cancelEdit() {
            editingIndex = null;
            document.getElementById('exercise').value = '';
            document.getElementById('customExercise').value = '';
            document.getElementById('setsContainer').innerHTML = `
                <div class="flex gap-2 items-center set-row">
                    <span class="text-gray-400 text-sm w-6">1.</span>
                    <input type="number" placeholder="–í–µ—Å" class="set-weight w-20 border rounded px-2 py-1 text-center">
                    <span class="text-gray-400">–∫–≥ √ó</span>
                    <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                </div>
            `;
            document.getElementById('saveBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        function saveExercise() {
            const exercise = document.getElementById('customExercise').value || document.getElementById('exercise').value;
            if (!exercise) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
                return;
            }

            const rows = document.querySelectorAll('.set-row');
            const sets = [];
            rows.forEach(row => {
                const weight = parseFloat(row.querySelector('.set-weight').value) || 0;
                const reps = parseInt(row.querySelector('.set-reps').value) || 0;
                if (reps > 0) {
                    sets.push({ weight, reps });
                }
            });

            if (sets.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
                return;
            }

            if (editingIndex !== null) {
                // –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                currentExercises[editingIndex] = { exercise, sets };
                editingIndex = null;
                document.getElementById('saveBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                document.getElementById('cancelBtn').classList.add('hidden');
            } else {
                // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                currentExercises.push({ exercise, sets });
            }
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
            const dateKey = getDateKey();
            workouts[dateKey] = currentExercises;
            localStorage.setItem('strengthWorkouts', JSON.stringify(workouts));

            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('exercise').value = '';
            document.getElementById('customExercise').value = '';
            document.getElementById('setsContainer').innerHTML = `
                <div class="flex gap-2 items-center set-row">
                    <span class="text-gray-400 text-sm w-6">1.</span>
                    <input type="number" placeholder="–í–µ—Å" class="set-weight w-20 border rounded px-2 py-1 text-center">
                    <span class="text-gray-400">–∫–≥ √ó</span>
                    <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                </div>
            `;

            renderCurrentWorkout();
            renderHistory();
            renderVolumeChart();
        }

        function loadWorkout() {
            const dateKey = getDateKey();
            currentExercises = workouts[dateKey] || [];
            renderCurrentWorkout();
        }

        function deleteExercise(index) {
            currentExercises.splice(index, 1);
            const dateKey = getDateKey();
            if (currentExercises.length > 0) {
                workouts[dateKey] = currentExercises;
            } else {
                delete workouts[dateKey];
            }
            localStorage.setItem('strengthWorkouts', JSON.stringify(workouts));
            renderCurrentWorkout();
            renderHistory();
            renderVolumeChart();
        }

        function renderCurrentWorkout() {
            const container = document.getElementById('currentWorkout');
            const volumeEl = document.getElementById('totalVolume');
            
            if (currentExercises.length === 0) {
                container.innerHTML = '<p class="p-4 text-gray-400 text-center text-sm">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>';
                volumeEl.textContent = '';
                return;
            }

            let totalVolume = 0;
            container.innerHTML = currentExercises.map((ex, i) => {
                const setsStr = ex.sets.map(s => {
                    totalVolume += s.weight * s.reps;
                    return `${s.weight}√ó${s.reps}`;
                }).join(', ');

                return `
                    <div class="p-3 flex justify-between items-start hover:bg-gray-50 cursor-pointer" onclick="editExercise(${i})">
                        <div>
                            <div class="font-medium text-gray-800">${ex.exercise}</div>
                            <div class="text-sm text-gray-500">${setsStr}</div>
                        </div>
                        <button onclick="event.stopPropagation(); deleteExercise(${i})" class="text-gray-300 hover:text-red-500">‚úï</button>
                    </div>
                `;
            }).join('');

            volumeEl.textContent = `–û–±—ä—ë–º: ${totalVolume.toLocaleString()} –∫–≥`;
        }

        function renderVolumeChart() {
            const container = document.getElementById('volumeChart');
            const dates = Object.keys(workouts).sort();

            if (dates.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm w-full text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }

            // –ü–æ—Å—á–∏—Ç–∞—Ç—å –æ–±—ä—ë–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
            const volumes = dates.map(date => {
                const exercises = workouts[date];
                let total = 0;
                exercises.forEach(ex => {
                    ex.sets.forEach(s => {
                        total += s.weight * s.reps;
                    });
                });
                return { date, total };
            });

            const maxVolume = Math.max(...volumes.map(v => v.total));
            const minVolume = Math.min(...volumes.map(v => v.total));

            container.innerHTML = volumes.map(v => {
                const heightPercent = maxVolume > 0 ? (v.total / maxVolume) * 100 : 0;
                // Opacity –æ—Ç 0.5 –¥–æ 1 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
                const opacity = minVolume === maxVolume ? 1 : 0.5 + 0.5 * ((v.total - minVolume) / (maxVolume - minVolume));
                const d = new Date(v.date);
                const dayStr = `${d.getDate()}.${(d.getMonth()+1).toString().padStart(2,'0')}`;

                return `
                    <div class="flex flex-col items-center flex-shrink-0" style="min-width: 36px;">
                        <div class="text-xs text-gray-500 mb-1">${v.total >= 1000 ? Math.round(v.total/1000) + 'k' : v.total}</div>
                        <div class="w-6 bg-blue-500 rounded-t cursor-pointer hover:bg-blue-600"
                             style="height: ${Math.max(heightPercent, 5)}%; opacity: ${opacity.toFixed(2)};"
                             onclick="document.getElementById('workoutDate').value='${v.date}'; loadWorkout();"></div>
                        <div class="text-xs text-gray-400 mt-1">${dayStr}</div>
                    </div>
                `;
            }).join('');
        }

        function renderHistory() {
            const container = document.getElementById('history');
            const dates = Object.keys(workouts).sort().reverse();
            
            if (dates.length === 0) {
                container.innerHTML = '<p class="p-4 text-gray-400 text-center text-sm">–ü—É—Å—Ç–æ</p>';
                return;
            }

            container.innerHTML = dates.map(date => {
                const exercises = workouts[date];
                const d = new Date(date);
                const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                const dateStr = `${days[d.getDay()]}, ${d.getDate()}.${(d.getMonth()+1).toString().padStart(2,'0')}`;
                
                const exercisesList = exercises.map(ex => {
                    const best = ex.sets.reduce((max, s) => s.weight > max.weight ? s : max, {weight: 0});
                    return `${ex.exercise} (${best.weight}√ó${best.reps})`;
                }).join(', ');

                return `
                    <div class="p-3 cursor-pointer hover:bg-gray-50" onclick="document.getElementById('workoutDate').value='${date}'; loadWorkout();">
                        <div class="font-medium text-gray-700">${dateStr}</div>
                        <div class="text-sm text-gray-500 truncate">${exercisesList}</div>
                    </div>
                `;
            }).join('');
        }

        // –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)
        const initialData = {
            "2025-11-23": [
                { exercise: "–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –ø–æ–¥ —É–≥–ª–æ–º 45¬∞", sets: [{weight: 7.5, reps: 12}, {weight: 10, reps: 12}, {weight: 12.5, reps: 12}, {weight: 15, reps: 12}] },
                { exercise: "–ñ–∏–º –ª—ë–∂–∞", sets: [{weight: 40, reps: 12}, {weight: 45, reps: 12}, {weight: 50, reps: 7}, {weight: 50, reps: 7}] },
                { exercise: "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –≤ –±–ª–æ–∫–µ (—Ç—Ä–∏—Ü–µ–ø—Å)", sets: [{weight: 25, reps: 12}, {weight: 30, reps: 12}, {weight: 35, reps: 12}, {weight: 40, reps: 12}] }
            ],
            "2025-11-24": [
                { exercise: "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏", sets: [{weight: 25, reps: 12}, {weight: 30, reps: 12}, {weight: 35, reps: 12}, {weight: 40, reps: 12}] },
                { exercise: "–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ –±–ª–æ–∫–∞ –∫ –ø–æ—è—Å—É", sets: [{weight: 25, reps: 12}, {weight: 30, reps: 12}, {weight: 35, reps: 12}, {weight: 40, reps: 12}] },
                { exercise: "–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –ø–ª–µ—á–∏", sets: [{weight: 7.5, reps: 12}, {weight: 10, reps: 12}, {weight: 10, reps: 12}] }
            ]
        };

        // –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∏—Ö –µ—â—ë –Ω–µ—Ç
        for (const [date, exercises] of Object.entries(initialData)) {
            if (!workouts[date]) {
                workouts[date] = exercises;
            }
        }
        localStorage.setItem('strengthWorkouts', JSON.stringify(workouts));

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadWorkout();
        renderHistory();
        renderVolumeChart();
    </script>
</body>
</html>
