<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–ª–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="max-w-lg mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-4 text-gray-800">üèãÔ∏è –°–∏–ª–æ–≤—ã–µ</h1>
        
        <!-- –î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex items-center gap-3">
                <label class="text-gray-600">–î–∞—Ç–∞:</label>
                <input type="date" id="workoutDate" class="border rounded px-3 py-1 flex-1">
                <button onclick="loadWorkout()" class="bg-gray-200 px-3 py-1 rounded text-sm">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>

        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex gap-2 mb-3">
                <select id="exercise" class="flex-1 border rounded px-3 py-2">
                    <option value="">–í—ã–±—Ä–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
                    <optgroup label="–ì—Ä—É–¥—å">
                        <option>–ñ–∏–º –ª—ë–∂–∞</option>
                        <option>–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π</option>
                        <option>–†–∞–∑–≤–æ–¥–∫–∞</option>
                        <option>–û—Ç–∂–∏–º–∞–Ω–∏—è</option>
                    </optgroup>
                    <optgroup label="–°–ø–∏–Ω–∞">
                        <option>–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏</option>
                        <option>–¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª–∏</option>
                        <option>–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è</option>
                        <option>–¢—è–≥–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞</option>
                    </optgroup>
                    <optgroup label="–ù–æ–≥–∏">
                        <option>–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è</option>
                        <option>–ñ–∏–º –Ω–æ–≥–∞–º–∏</option>
                        <option>–í—ã–ø–∞–¥—ã</option>
                        <option>–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞</option>
                    </optgroup>
                    <optgroup label="–ü–ª–µ—á–∏">
                        <option>–ñ–∏–º —Å—Ç–æ—è</option>
                        <option>–ñ–∏–º —Å–∏–¥—è</option>
                        <option>–ú–∞—Ö–∏ –≤ —Å—Ç–æ—Ä–æ–Ω—ã</option>
                    </optgroup>
                    <optgroup label="–†—É–∫–∏">
                        <option>–ë–∏—Ü–µ–ø—Å —à—Ç–∞–Ω–≥–∞</option>
                        <option>–ë–∏—Ü–µ–ø—Å –≥–∞–Ω—Ç–µ–ª–∏</option>
                        <option>–¢—Ä–∏—Ü–µ–ø—Å –±–ª–æ–∫</option>
                        <option>–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º</option>
                    </optgroup>
                </select>
                <input type="text" id="customExercise" placeholder="–ò–ª–∏ —Å–≤–æ—ë" class="w-28 border rounded px-2 py-2 text-sm">
            </div>
            
            <!-- –ü–æ–¥—Ö–æ–¥—ã -->
            <div id="setsContainer" class="space-y-2 mb-3">
                <div class="flex gap-2 items-center set-row">
                    <span class="text-gray-400 text-sm w-6">1.</span>
                    <input type="number" placeholder="–í–µ—Å" class="set-weight w-20 border rounded px-2 py-1 text-center">
                    <span class="text-gray-400">–∫–≥ √ó</span>
                    <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                </div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="addSetRow()" class="flex-1 bg-gray-100 text-gray-600 py-2 rounded text-sm hover:bg-gray-200">
                    + –ü–æ–¥—Ö–æ–¥
                </button>
                <button onclick="saveExercise()" class="flex-1 bg-blue-500 text-white py-2 rounded font-medium hover:bg-blue-600">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –¢–µ–∫—É—â–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ -->
        <div class="bg-white rounded-lg shadow mb-4">
            <div class="p-3 border-b flex justify-between items-center">
                <span class="font-medium text-gray-700">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
                <span id="totalVolume" class="text-sm text-gray-500"></span>
            </div>
            <div id="currentWorkout" class="divide-y">
                <p class="p-4 text-gray-400 text-center text-sm">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>
            </div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-3 border-b flex justify-between items-center">
                <span class="font-medium text-gray-700">–ò—Å—Ç–æ—Ä–∏—è</span>
                <button onclick="toggleHistory()" id="historyToggle" class="text-sm text-blue-500">–ü–æ–∫–∞–∑–∞—Ç—å</button>
            </div>
            <div id="history" class="hidden divide-y max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        let workouts = JSON.parse(localStorage.getItem('strengthWorkouts') || '{}');
        let currentExercises = [];

        document.getElementById('workoutDate').valueAsDate = new Date();

        function getDateKey() {
            return document.getElementById('workoutDate').value;
        }

        function addSetRow() {
            const container = document.getElementById('setsContainer');
            const num = container.children.length + 1;
            const lastRow = container.lastElementChild;
            const lastWeight = lastRow?.querySelector('.set-weight')?.value || '';
            
            const row = document.createElement('div');
            row.className = 'flex gap-2 items-center set-row';
            row.innerHTML = `
                <span class="text-gray-400 text-sm w-6">${num}.</span>
                <input type="number" placeholder="–í–µ—Å" value="${lastWeight}" class="set-weight w-20 border rounded px-2 py-1 text-center">
                <span class="text-gray-400">–∫–≥ √ó</span>
                <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                <button onclick="this.parentElement.remove(); renumberSets()" class="text-gray-300 hover:text-red-500">‚úï</button>
            `;
            container.appendChild(row);
        }

        function renumberSets() {
            const rows = document.querySelectorAll('.set-row');
            rows.forEach((row, i) => {
                row.querySelector('span').textContent = (i + 1) + '.';
            });
        }

        function saveExercise() {
            const exercise = document.getElementById('customExercise').value || document.getElementById('exercise').value;
            if (!exercise) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
                return;
            }

            const rows = document.querySelectorAll('.set-row');
            const sets = [];
            rows.forEach(row => {
                const weight = parseFloat(row.querySelector('.set-weight').value) || 0;
                const reps = parseInt(row.querySelector('.set-reps').value) || 0;
                if (reps > 0) {
                    sets.push({ weight, reps });
                }
            });

            if (sets.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥');
                return;
            }

            currentExercises.push({ exercise, sets });
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
            const dateKey = getDateKey();
            workouts[dateKey] = currentExercises;
            localStorage.setItem('strengthWorkouts', JSON.stringify(workouts));

            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('exercise').value = '';
            document.getElementById('customExercise').value = '';
            document.getElementById('setsContainer').innerHTML = `
                <div class="flex gap-2 items-center set-row">
                    <span class="text-gray-400 text-sm w-6">1.</span>
                    <input type="number" placeholder="–í–µ—Å" class="set-weight w-20 border rounded px-2 py-1 text-center">
                    <span class="text-gray-400">–∫–≥ √ó</span>
                    <input type="number" placeholder="–†–∞–∑" class="set-reps w-16 border rounded px-2 py-1 text-center">
                </div>
            `;

            renderCurrentWorkout();
            renderHistory();
        }

        function loadWorkout() {
            const dateKey = getDateKey();
            currentExercises = workouts[dateKey] || [];
            renderCurrentWorkout();
        }

        function deleteExercise(index) {
            currentExercises.splice(index, 1);
            const dateKey = getDateKey();
            if (currentExercises.length > 0) {
                workouts[dateKey] = currentExercises;
            } else {
                delete workouts[dateKey];
            }
            localStorage.setItem('strengthWorkouts', JSON.stringify(workouts));
            renderCurrentWorkout();
            renderHistory();
        }

        function renderCurrentWorkout() {
            const container = document.getElementById('currentWorkout');
            const volumeEl = document.getElementById('totalVolume');
            
            if (currentExercises.length === 0) {
                container.innerHTML = '<p class="p-4 text-gray-400 text-center text-sm">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>';
                volumeEl.textContent = '';
                return;
            }

            let totalVolume = 0;
            container.innerHTML = currentExercises.map((ex, i) => {
                const setsStr = ex.sets.map(s => {
                    totalVolume += s.weight * s.reps;
                    return `${s.weight}√ó${s.reps}`;
                }).join(', ');
                
                return `
                    <div class="p-3 flex justify-between items-start hover:bg-gray-50">
                        <div>
                            <div class="font-medium text-gray-800">${ex.exercise}</div>
                            <div class="text-sm text-gray-500">${setsStr}</div>
                        </div>
                        <button onclick="deleteExercise(${i})" class="text-gray-300 hover:text-red-500">‚úï</button>
                    </div>
                `;
            }).join('');

            volumeEl.textContent = `–û–±—ä—ë–º: ${totalVolume.toLocaleString()} –∫–≥`;
        }

        function toggleHistory() {
            const el = document.getElementById('history');
            const btn = document.getElementById('historyToggle');
            el.classList.toggle('hidden');
            btn.textContent = el.classList.contains('hidden') ? '–ü–æ–∫–∞–∑–∞—Ç—å' : '–°–∫—Ä—ã—Ç—å';
        }

        function renderHistory() {
            const container = document.getElementById('history');
            const dates = Object.keys(workouts).sort().reverse();
            
            if (dates.length === 0) {
                container.innerHTML = '<p class="p-4 text-gray-400 text-center text-sm">–ü—É—Å—Ç–æ</p>';
                return;
            }

            container.innerHTML = dates.map(date => {
                const exercises = workouts[date];
                const d = new Date(date);
                const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                const dateStr = `${days[d.getDay()]}, ${d.getDate()}.${(d.getMonth()+1).toString().padStart(2,'0')}`;
                
                const exercisesList = exercises.map(ex => {
                    const best = ex.sets.reduce((max, s) => s.weight > max.weight ? s : max, {weight: 0});
                    return `${ex.exercise} (${best.weight}√ó${best.reps})`;
                }).join(', ');

                return `
                    <div class="p-3 cursor-pointer hover:bg-gray-50" onclick="document.getElementById('workoutDate').value='${date}'; loadWorkout();">
                        <div class="font-medium text-gray-700">${dateStr}</div>
                        <div class="text-sm text-gray-500 truncate">${exercisesList}</div>
                    </div>
                `;
            }).join('');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadWorkout();
        renderHistory();
    </script>
</body>
</html>
